<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>Calendar </title>
<style type="text/css">
* {
	margin:0px;
	padding:0px;
	font-family:"Microsoft YaHei";
}
.mainContainer {
	position:absolute;
	width:100%;
	height:100%;
	overflow:hidden;
}
.mainContent {
	position:absolute;
	width:100%;
	top:48px;
}
.eventBox {
	position:absolute;
	top:80px;
	width:798px;
	height:528px;
	background-color:#FFF;
	border:solid 1px #999;
}
.dateInfo {
	position:absolute;
	width:280px;
	height:50px;
	left:30px;
	top:15px;
	color:#666;
	font-size:30px;
}
.dateInfo_yearValue {
	position:absolute;
	left:0px;
	top:0px;
}
.dateInfo_year {
	position:absolute;
	left:80px;
	top:0px;
}
.dateInfo_monthValue {
	position:absolute;
	left:120px;
	top:0px;
}
.dateInfo_month {
	position:absolute;
	top:0px;
}
.dateInfo_dateValue {
	position:absolute;
	top:0px;
}
.dateInfo_date {
	position:absolute;
	top:0px;
}
.eventContainer {
	position:absolute;
	width:738px;
	height:400px;
	top:90px;
	left:30px;
	overflow-x:auto
}
.eventTipInfo {
	position:absolute;
	width:738px;
	top:100px;
	text-align:center;
	font-size:36px;
	color:#CCC;
}
.event {
	position:absolute;
	width:196px;
	height:220px;
	top:20px;
	border:solid 2px #999;
	cursor:pointer;
}
.dataContainer {
	position:absolute;
	width:180px;
	height:25px;
	font-size:14px;
	color:#333;
	left:10px;
}
.dataTip {
	position:absolute;
	width:80px;
	height:25px;
	left:0px;
	text-align:center;
}
.data {
	position:absolute;
	width:100px;
	height:25px;
	left:80px;
	text-align:center;
}
.tipInfoContainer {
	position:absolute;
	width:200px;
	height:25px;
	left:-2px;
	top:220px;
	background-color:#999;
	color:#FFF;
	text-align:center;
}
.clientTypeDiv {
	position:absolute;
	width:200px;
	height:25px;
	left:-2px;
	top:-25px;
	background-color:#999;
	color:#FFF;
}
.clientTypeDiv span {
	position:absolute;
	width:100%;
	top:2px;
	text-align:center;
}
.completeButtonContainer {
	position:absolute;
	width:196px;
	height:220px;
	left:0px;
	top:0px;
	background-color:#333;
	opacity:0.8;
}
.completeTip {
	position:absolute;
	width:196px;
	height:20px;
	color:#FFF;
	text-align:center;
	top:50px;
	font-size:16px;
}
.completeButton {
	position:absolute;
	width:30px;
	height:30px;
	background-image:url(img/completeButton.png);
	bottom:30px;
	left:30px;
	opacity:1;
}
.cancelCompleteButton {
	position:absolute;
	width:30px;
	height:30px;
	background-image:url(img/cancelButton01.png);
	bottom:30px;
	right:30px;
	opacity:1;
}
.functionalSequence {
	position:absolute;
	width:400px;
	height:180px;
	background-color:#FFF;
	border:solid 2px #999;
}
.functionalSequence span {
	position:absolute;
	width:400px;
	height:auto;
	font-size:18px;
	text-align:center;
	top:75px;
}
/*伪样式*/
.lastMonth {
}
.today {
}
.thisMonth {
}
.nextMonth {
}
</style>
<link rel="stylesheet" href="CSS/menuBar.css" />
<link rel="stylesheet" href="CSS/informationBar.css" />
<link rel="stylesheet" href="CSS/calendarBox.css" />
<link rel="stylesheet" href="CSS/newButtonSettingBox.css" />
<script type="text/javascript" src='../../JS/jQuery/JQuery-1.9.1/jQuery-1.9.1.js'></script>
<script type="text/javascript" src='JS/publicFunction.js'></script>
<script type="text/javascript" src="JS/calendarFunction.js"></script>
<script type="text/javascript">
$(document).ready(function(e) {
	/*缓存DOM*/
	$mainContainer = $('.mainContainer');
	$informationBar = $('.informationBar');
	$calendarBox = $('.calendarBox');
	$titleNameContainer = $('.titleNameContainer');
	$titleName = $('.titleName');
	$menuButton = $('.menuButton');
	$newButton = $('#newButton');
	$contactsButton = $('#contactsButton');
	$lastMonthButton = $('.lastMonthButton');
	$nextMonthButton = $('.nextMonthButton');
	$weekContainer = $('.weekContainer');
	$weekNum = $('.weekNum');
	$dateContainer = $('.dateContainer');
	$dateContainer01 = $('#dateContainer01');
	$dateContainer02 = $('#dateContainer02');
	$dateContainer03 = $('#dateContainer03');
	$dateContainer04 = $('#dateContainer04');
	$dateContainer05 = $('#dateContainer05');
	$calendarInfoBox = $('.calendarInfoBox');
	$calendarInfoBox_yearValue = $('.calendarInfoBox_yearValue');
	$calendarInfoBox_year = $('.calendarInfoBox_year');
	$calendarInfoBox_monthValue = $('.calendarInfoBox_monthValue');
	$calendarInfoBox_month = $('.calendarInfoBox_month');
	$dateBox = $('.dateBox');
	/*分辨率匹配及初始化*/
	var $pageWidth = document.body.offsetWidth;
	var $pageHeight = $mainContainer.css("height");
	var dateObj = new Date();
	var thisYear = dateObj.getFullYear();
	var thisMonth = dateObj.getMonth();
	var thisDate = dateObj.getDate();
	initializeFunction($pageWidth,$pageHeight,dateObj,thisYear,thisMonth,thisDate);
	verticalCenterFunction($titleNameContainer,$titleName);
	verticalCenterFunction($menuButton,$menuButton.children('.menuButtonName'));
	verticalCenterFunction($calendarInfoBox,$calendarInfoBox_year);
	verticalCenterFunction($calendarInfoBox,$calendarInfoBox_month);
	/*公共函数*/
	menuFunction($menuButton,newButtonFunction);
	monthButtonFunction($pageWidth);
	$contactsButton.bind('click',function() {
		$("<div class='functionalSequence'><span>敬请期待</span><div class='cancelButton'></div></div>").appendTo($mainContainer);
		$cancelButton = $('.cancelButton');
		$functionalSequence = $('.functionalSequence');
		$('<div>'+'</div>').appendTo($functionalSequence).css({"width":"100%","height":"4px","position":"absolute","top":"0px","background-color":"#1e6c6d"});
		$functionalSequence.css({"top":"135px","left":($pageWidth-400)/2+'px'});
		$cancelButton.bind('click',function() {
			$functionalSequence.remove();
		});
	});
	/*日历函数*/
	calendarFunction(dateObj,thisYear,thisMonth,thisDate);
	/*日历控制函数*/
	$lastMonthButton.bind('click',function() {
	    if(thisMonth>0) {
		    thisMonth = thisMonth - 1;
		    $calendarBox.children('#dateContainer06').remove();
		    initializeFunction($pageWidth,$pageHeight,dateObj,thisYear,thisMonth,thisDate);
		    calendarFunction(dateObj,thisYear,thisMonth,thisDate);
	    } else if(thisMonth<=0) {
		    thisYear = thisYear - 1;
		    thisMonth = 11;
		    $calendarBox.children('#dateContainer06').remove();
		    initializeFunction($pageWidth,$pageHeight,dateObj,thisYear,thisMonth,thisDate);
		    calendarFunction(dateObj,thisYear,thisMonth,thisDate);
	    };
    });
    $nextMonthButton.bind('click',function() {
	    if(thisMonth+1<12) {
		    thisMonth = thisMonth + 1;
		    $calendarBox.children('#dateContainer06').remove();
		    initializeFunction($pageWidth,$pageHeight,dateObj,thisYear,thisMonth,thisDate);
		    calendarFunction(dateObj,thisYear,thisMonth,thisDate);
	    } else if(thisMonth+1>=12) {
		    thisYear = thisYear + 1;
		    thisMonth = 0;
		    $calendarBox.children('#dateContainer06').remove();
		    initializeFunction($pageWidth,$pageHeight,dateObj,thisYear,thisMonth,thisDate);
		    calendarFunction(dateObj,thisYear,thisMonth,thisDate);
	    };
    });
	/*事件盒子函数*/
	$dateBox.bind('click',function() {
		if(!$mainContainer.children().hasClass('eventBox')) {
		    $("<div class='eventBox'></div>").appendTo($mainContainer);
		    $eventBox = $('.eventBox');
		    $eventBox.css({"left":(document.body.offsetWidth - 800)/2 +'px'});
		    $("<div class='cancelButton'></div>").appendTo($eventBox);
		    $cancelButton = $('.cancelButton');
		    $cancelButton.bind('click',function() {
			    $eventBox.fadeOut(200,function() {
				    $(this).remove();
					calendarFunction(dateObj,thisYear,thisMonth,thisDate);
			    });		
		    });
	        $dateBoxTemp = $(this);
		    $("<div class='dateInfo'></div>").appendTo($eventBox);
		    $dateInfo = $('.dateInfo');
		    temp01 = $dateBoxTemp.children('span').html().substring(0,$dateBoxTemp.children('span').html().indexOf('日'));
		    $("<div class='dateInfo_yearValue'></div><div class='dateInfo_year'>年</div><div class='dateInfo_monthValue'></div><div class='dateInfo_month'>月</div><div class='dateInfo_dateValue'></div><div class='dateInfo_date'>日</div>").appendTo($dateInfo);
		    $dateInfo_yearValue = $('.dateInfo_yearValue');
		    $dateInfo_year = $('.dateInfo_year');
		    $dateInfo_monthValue = $('.dateInfo_monthValue');
		    $dateInfo_month = $('.dateInfo_month');
		    $dateInfo_dateValue = $('.dateInfo_dateValue');
		    $dateInfo_date = $('.dateInfo_date');
			$("<div class='eventContainer'></div>").appendTo($eventBox);
			$eventContainer = $('.eventContainer');
			if(!$dateBoxTemp.children().hasClass('eventInfo')) {
				if(!$eventContainer.children().hasClass('eventTipInfo')) {
				    $("<div class='eventTipInfo'>无日程事项</div>").appendTo($eventContainer);
				};
			};
			if($(this).hasClass('lastMonth')) {
			    if($calendarInfoBox_monthValue.html()=='1') {
					$dataBoxYearValue=$calendarInfoBox_yearValue.html()-1;
					$dataBoxMonthValue='12';
					$dataBoxDayValue=temp01;
					$dateInfo_yearValue.html($calendarInfoBox_yearValue.html()-1);
			        $dateInfo_monthValue.html('12');
			        $dateInfo_dateValue.html(temp01);
				} else {
					$dataBoxYearValue=$calendarInfoBox_yearValue.html();
					$dataBoxMonthValue=$calendarInfoBox_monthValue.html()-1;
					$dataBoxDayValue=temp01;
					$dateInfo_yearValue.html($calendarInfoBox_yearValue.html());
			        $dateInfo_monthValue.html($calendarInfoBox_monthValue.html()-1);
			        $dateInfo_dateValue.html(temp01);
				};
		    } else if($(this).hasClass('nextMonth')) {
			    if($calendarInfoBox_monthValue.html()=='12') {
					$dataBoxYearValue=$calendarInfoBox_yearValue.html()-1+2;
					$dataBoxMonthValue='1';
					$dataBoxDayValue=temp01;
					$dateInfo_yearValue.html($calendarInfoBox_yearValue.html()-1+2);
			        $dateInfo_monthValue.html('1');
			        $dateInfo_dateValue.html(temp01);
				} else {
					$dataBoxYearValue=$calendarInfoBox_yearValue.html();
					$dataBoxMonthValue=$calendarInfoBox_monthValue.html()-1+2;
					$dataBoxDayValue=temp01;
					$dateInfo_yearValue.html($calendarInfoBox_yearValue.html());
			        $dateInfo_monthValue.html($calendarInfoBox_monthValue.html()-1+2);
			        $dateInfo_dateValue.html(temp01);
				};
	        } else {
			    $dataBoxYearValue=$calendarInfoBox_yearValue.html();
				$dataBoxMonthValue=$calendarInfoBox_monthValue.html();
				$dataBoxDayValue=temp01;
				$dateInfo_yearValue.html($calendarInfoBox_yearValue.html());
			    $dateInfo_monthValue.html($calendarInfoBox_monthValue.html());
			    $dateInfo_dateValue.html(temp01);
		    };
			verticalCenterFunction($dateInfo,$dateInfo_yearValue);
		    verticalCenterFunction($dateInfo,$dateInfo_year);
		    verticalCenterFunction($dateInfo,$dateInfo_monthValue);
		    verticalCenterFunction($dateInfo,$dateInfo_month);
		    verticalCenterFunction($dateInfo,$dateInfo_dateValue);
		    verticalCenterFunction($dateInfo,$dateInfo_date);
		    $dateInfo_month.css({"left":($dateInfo_monthValue.width()-1+131)+'px'});
		    $dateInfo_dateValue.css({"left":$dateInfo_monthValue.width()-1+166+'px'});
		    $dateInfo_date.css({"left":($dateInfo_monthValue.width()-1+176+($dateInfo_dateValue.width()-1+1))+'px'});
		    $.ajax({
	            url:"CalendarDataMange.php",
		        type:"POST",
	            data:{dateBoxYear:$dataBoxYearValue,dateBoxMonth:$dataBoxMonthValue,dateBoxDay:$dataBoxDayValue,today:'',progressStatus:'achieveDataBaseLengthProgress'},
	            success: function(data,status) {
			        var eventDataLength = data;
					//console.log(eventDataLength);
			        if(eventDataLength!=0) {
			            $.ajax({
	                        url:"CalendarDataMange.php",
		                    type:"POST",
	                        data:{dateBoxYear:$dataBoxYearValue,dateBoxMonth:$dataBoxMonthValue,dateBoxDay:$dataBoxDayValue,progressStatus:'achieveEventProgress'},
	                        success: function(data,status) {
						        var eventData = $.parseJSON(data);
						        //console.log(data);
					            for(var i=0;i<eventDataLength;i++) {
						            $("<div class='event'><div class='clientNameContainer dataContainer'><div class='clientNameTip dataTip'>客户名称</div><div class='clientName data'>"+ eventData[i]['clientName'] +"</div></div><div class='clientNumberContainer dataContainer'><div class='clientNumberTip dataTip'>客户编号</div><div class='clientNumber data'>"+ eventData[i]['clientNumber'] +"</div></div><div class='clientAddressContainer dataContainer'><div class='clientAddressTip dataTip'>客户地址</div><div class='clientAddress data'>"+ eventData[i]['clientAddress'] +"</div></div><div class='measuringTypeContainer dataContainer'><div class='measuringTypeTip dataTip'>计量方式</div><div class='measuringType data'>"+ eventData[i]['measuringType'] +"</div></div><div class='voltageRankContainer dataContainer'><div class='voltageRankTip dataTip'>电压等级</div><div class='voltageRank data'>"+ eventData[i]['voltageRank'] +"</div></div><div class='workerNameContainer dataContainer'><div class='workerNameTip dataTip'>工单受理人</div><div class='workerName data'>"+ eventData[i]['workerName'] +"</div></div><div class='tipInfoContainer'></div><div class='clientTypeDiv'></div></div>").appendTo($eventContainer);
								    $eventTemp = $eventContainer.children().eq(i);
								    $eventTemp.css({"left":(i*220)+'px'});
									for(var j=0;j<6;j++) {
										$eventTemp.children('.dataContainer').eq(j).css({"top":30*j-1+16+"px"});
									};
									$tipInfoContainer = $eventContainer.children().eq(i).children('.tipInfoContainer');
									$clientTypeDiv = $eventContainer.children().eq(i).children('.clientTypeDiv');
									if(eventData[i]['deadlineNumber']==0){
										if(eventData[i]['completeStatus']=='yes') {
											$tipInfoContainer.html('已完成');
										} else if(eventData[i]['completeStatus']=='no') {
											$tipInfoContainer.html('工单已超时限请立即处理');
										};
									} else {
										$tipInfoContainer.html('超时限剩余'+eventData[i]['deadlineNumber']+'天');
									};
									if(eventData[i]['clientType']==1) {
										$clientTypeDiv.html('<span>居民客户</span>');
									} else if(eventData[i]['clientType']==2) {
										$clientTypeDiv.html('<span>非居民客户</span>');
									};
									$event = $('.event');
									addCompleteButtonContainer = function() {
									    $event.bind('click',function() {
											$thisTemp = $(this);
											if($thisTemp.children('.tipInfoContainer').html()!='已完成') {
										        $event.unbind('click');
										        if(!$thisTemp.children().hasClass('completeButtonContainer')) {
											        $("<div class='completeButtonContainer'><div class='completeTip'>完成？</div><div class='completeButton'></div><div class='cancelCompleteButton'></div>").appendTo($thisTemp);
											        $completeButtonContainer = $thisTemp.children('.completeButtonContainer');
										            $cancelCompleteButton = $thisTemp.children().children('.cancelCompleteButton');
												    $completeButton = $thisTemp.children().children('.completeButton');
										            $cancelCompleteButton.bind('click',function() {
											            $completeButtonContainer.remove();
														$event.bind('click',addCompleteButtonContainer);
										            });
													$clientNumber01 = $thisTemp.children('.clientNumberContainer').children('.clientNumber').html();
												    $completeButton.bind('click',function() {
														$completeButton.unbind('click');
													    $.ajax({
	                                                        url:"CalendarDataMange.php",
		                                                    type:"POST",
	                                                        data:{clientNumber:$clientNumber01,progressStatus:'accomplishWork'},
	                                                        success: function(data,status) {
															    //console.log(data);
															    if(data=='ok') {
																    $thisTemp.children('.tipInfoContainer').html('已完成');
															        $completeButtonContainer.remove();
														        };
							                                }
													    });
														$event.bind('click',addCompleteButtonContainer);
										            });
										        };
											};
									    });
					                };
									addCompleteButtonContainer();
								};
		                    }
                        });
			        };
		        }
            });
        };
	});
});
</script>
</head>

<body>
<div class="mainContainer">
    <div class="menuBar">
        <div class="titleNameContainer">
            <div class="titleName">日程</div>
        </div>
        <div id="newButton" class="menuButton">
            <div class="menuButtonName">新建</div>
        </div>
        <div id="contactsButton" class="menuButton">
            <div class="menuButtonName">联系人</div>
        </div>
        <div id="helpButton" class="menuButton">
            <div class="menuButtonName">帮助</div>
        </div>
    </div>
    <div class="mainContent">
        <div class="informationBar">
            <div class="calendarInformation">
                <div class="lastMonthButton"></div>
                <div class="nextMonthButton"></div>
                <div class='calendarInfoBox'><div class='calendarInfoBox_yearValue'></div><div class="calendarInfoBox_year">年</div><div class="calendarInfoBox_monthValue"></div><div class="calendarInfoBox_month">月</div></div>
            </div>
        </div>
        <div class="calendarBox">
            <div class="weekContainer">
                <div id='weekNum01' class="weekNum"><span>星期日</span></div>
                <div id='weekNum02' class="weekNum"><span>星期一</span></div>
                <div id='weekNum03' class="weekNum"><span>星期二</span></div>
                <div id='weekNum04' class="weekNum"><span>星期三</span></div>
                <div id='weekNum05' class="weekNum"><span>星期四</span></div>
                <div id='weekNum06' class="weekNum"><span>星期五</span></div>
                <div id='weekNum07' class="weekNum"><span>星期六</span></div>
            </div>
            <div id="dateContainer01" class="dateContainer">
                <div id='dateBox01' class="dateBox"><span></span></div>
                <div id='dateBox02' class="dateBox"><span></span></div>
                <div id='dateBox03' class="dateBox"><span></span></div>
                <div id='dateBox04' class="dateBox"><span></span></div>
                <div id='dateBox05' class="dateBox"><span></span></div>
                <div id='dateBox06' class="dateBox"><span></span></div>
                <div id='dateBox07' class="dateBox"><span></span></div>
            </div>
            <div id="dateContainer02" class="dateContainer">
                <div id='dateBox01' class="dateBox"><span></span></div>
                <div id='dateBox02' class="dateBox"><span></span></div>
                <div id='dateBox03' class="dateBox"><span></span></div>
                <div id='dateBox04' class="dateBox"><span></span></div>
                <div id='dateBox05' class="dateBox"><span></span></div>
                <div id='dateBox06' class="dateBox"><span></span></div>
                <div id='dateBox07' class="dateBox"><span></span></div>
            </div>
            <div id="dateContainer03" class="dateContainer">
                <div id='dateBox01' class="dateBox"><span></span></div>
                <div id='dateBox02' class="dateBox"><span></span></div>
                <div id='dateBox03' class="dateBox"><span></span></div>
                <div id='dateBox04' class="dateBox"><span></span></div>
                <div id='dateBox05' class="dateBox"><span></span></div>
                <div id='dateBox06' class="dateBox"><span></span></div>
                <div id='dateBox07' class="dateBox"><span></span></div>
            </div>
            <div id="dateContainer04" class="dateContainer">
                <div id='dateBox01' class="dateBox"><span></span></div>
                <div id='dateBox02' class="dateBox"><span></span></div>
                <div id='dateBox03' class="dateBox"><span></span></div>
                <div id='dateBox04' class="dateBox"><span></span></div>
                <div id='dateBox05' class="dateBox"><span></span></div>
                <div id='dateBox06' class="dateBox"><span></span></div>
                <div id='dateBox07' class="dateBox"><span></span></div>
            </div>
            <div id="dateContainer05" class="dateContainer">
                <div id='dateBox01' class="dateBox"><span></span></div>
                <div id='dateBox02' class="dateBox"><span></span></div>
                <div id='dateBox03' class="dateBox"><span></span></div>
                <div id='dateBox04' class="dateBox"><span></span></div>
                <div id='dateBox05' class="dateBox"><span></span></div>
                <div id='dateBox06' class="dateBox"><span></span></div>
                <div id='dateBox07' class="dateBox"><span></span></div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
